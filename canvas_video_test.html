<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Canvas Video Test</title>
<style>
body { margin: 0; background: #000; }
canvas { width: 100vw; height: 100vh; }
#info { position: fixed; top: 10px; left: 10px; background: lime; color: black; padding: 10px; font-family: monospace; font-size: 12px; z-index: 1000; }
video { display: none; }
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<video id="video" autoplay playsinline muted></video>
<div id="info">Starting canvas test...</div>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const video = document.getElementById('video');
const info = document.getElementById('info');

canvas.width = 1280;
canvas.height = 720;

let frameCount = 0;
let stream = null;

async function start() {
  try {
    info.innerHTML = 'Requesting camera...';
    
    stream = await navigator.mediaDevices.getUserMedia({ 
      video: { width: 1280, height: 720 },
      audio: false 
    });
    
    video.srcObject = stream;
    await video.play();
    
    info.innerHTML = 'Stream active! Drawing to canvas...';
    
    // Draw loop
    function draw() {
      if (video.readyState === video.HAVE_ENOUGH_DATA) {
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        frameCount++;
        
        // Draw info overlay
        ctx.fillStyle = 'rgba(0, 255, 0, 0.9)';
        ctx.fillRect(10, 10, 300, 80);
        ctx.fillStyle = 'black';
        ctx.font = '14px monospace';
        ctx.fillText('CANVAS RENDERING', 20, 30);
        ctx.fillText('Frames: ' + frameCount, 20, 50);
        ctx.fillText('Video: ' + video.videoWidth + 'x' + video.videoHeight, 20, 70);
        ctx.fillText('Ready: ' + video.readyState, 20, 90);
      }
      requestAnimationFrame(draw);
    }
    
    draw();
    info.style.display = 'none';
    
  } catch (err) {
    info.innerHTML = 'ERROR: ' + err.message;
    info.style.background = 'red';
    info.style.color = 'white';
  }
}

start();
</script>
</body>
</html>
