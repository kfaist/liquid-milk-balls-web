<!DOCTYPE html>
<html lang="en" style="--hue-value: 280; --hue-complementary: 100;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Mirror's Echo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --hue-value: 280; --hue-complementary: 100; }
        body { font-family: 'JetBrains Mono', monospace; background: #000; color: rgba(255, 255, 255, 0.9); padding: 2rem; line-height: 1.6; }
        .container { max-width: 1400px; width: 100%; margin: 0 auto; }
        
        h1.flicker { font-size: 1.5rem; font-weight: 400; text-align: center; margin-bottom: 3rem; letter-spacing: 0.1em; opacity: 0.8; animation: flicker 3s infinite; }
        @keyframes flicker {
            0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% { opacity: 0.8; }
            20%, 24%, 55% { opacity: 0.3; }
            22% { opacity: 0.5; transform: translate(-1px, 0); }
        }
        
        .intro-text { text-align: center; font-size: 0.65rem; opacity: 0.7; letter-spacing: 0.02em; line-height: 1.6; margin-bottom: 3rem; max-width: 800px; margin-left: auto; margin-right: auto; }
        .intro-text a { color: rgba(255, 255, 255, 0.9); text-decoration: none; border-bottom: 1px solid rgba(255, 255, 255, 0.3); transition: border-color 0.2s; }
        .intro-text a:hover { border-color: #fff; }
        
        .panel { background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.15); padding: 2rem; text-align: center; margin: 2rem 0; }
        .video-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem; }
        .video-grid.collapsed { grid-template-columns: 1fr; }
        .video-box { position: relative; }
        .video-box.hidden { display: none; }
        .video-label { font-size: 0.75rem; letter-spacing: 0.05em; opacity: 0.6; margin-bottom: 0.5rem; text-transform: uppercase; }
        .video-container { background: #000; border: 1px solid rgba(255, 255, 255, 0.3); aspect-ratio: 16/9; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; }
        video { width: 100%; height: 100%; object-fit: cover; }
        
        .expand-btn { position: absolute; top: 0.5rem; right: 0.5rem; padding: 0.4rem 0.8rem; font-size: 0.7rem; border: 1px solid rgba(255, 255, 255, 0.3); background: rgba(0, 0, 0, 0.3); color: #fff; cursor: pointer; font-family: 'JetBrains Mono', monospace; letter-spacing: 0.05em; transition: all 0.2s; z-index: 10; line-height: 1; opacity: 0.5; }
        .expand-btn:hover { border-color: #fff; background: rgba(255, 255, 255, 0.05); opacity: 0.8; }
        
        .btn { padding: 0.4rem 0.8rem; font-size: 0.7rem; border: 1px solid rgba(255, 255, 255, 0.3); background: transparent; color: #fff; cursor: pointer; transition: all 0.2s; font-family: 'JetBrains Mono', monospace; letter-spacing: 0.05em; }
        #startBtn { display: block; margin: 0.5rem auto 0 auto; width: fit-content; }
        .remote-controls { display: flex; gap: 0.5rem; margin-top: 0.5rem; justify-content: flex-start; }
        .btn:hover:not(:disabled) { border-color: #fff; background: rgba(255, 255, 255, 0.05); }
        .btn:disabled { opacity: 0.3; cursor: not-allowed; }
        
        .color-palette-box { background: rgba(0, 0, 0, 0.5); border: 1px solid rgba(255, 255, 255, 0.1); padding: 2rem; margin: 2rem 0; border-radius: 4px; }
        .palette-label { font-size: 0.75rem; letter-spacing: 0.05em; opacity: 0.6; text-transform: uppercase; margin-bottom: 0.8rem; }
        .color-palette { display: grid; grid-template-columns: repeat(8, 1fr); gap: 0.5rem; margin-bottom: 1.5rem; }
        .palette-btn { aspect-ratio: 1; border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 4px; cursor: pointer; transition: all 0.2s; padding: 0; min-height: 32px; opacity: 0.5; }
        .palette-btn:hover { border-color: rgba(255, 255, 255, 0.6); box-shadow: 0 0 12px currentColor; transform: scale(1.05); opacity: 0.7; }
        .palette-btn.active { opacity: 1; border-color: rgba(255, 255, 255, 1); box-shadow: 0 0 16px currentColor, inset 0 0 8px rgba(255, 255, 255, 0.3); }
        
        .control-panel { background: rgba(0, 0, 0, 0.5); border: 1px solid rgba(255, 255, 255, 0.1); padding: 2rem; margin: 2rem 0; border-radius: 4px; }
        .control-title { font-size: 0.85rem; letter-spacing: 0.1em; text-transform: uppercase; opacity: 0.7; margin-bottom: 1.5rem; }
        .sliders-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; }
        .slider-group { display: flex; flex-direction: column; gap: 0.5rem; }
        .slider-header { display: flex; justify-content: space-between; align-items: center; font-size: 0.75rem; }
        .slider-label { letter-spacing: 0.05em; opacity: 0.6; text-transform: uppercase; }
        .slider-value { color: hsl(var(--hue-value), 85%, 55%); font-weight: bold; font-size: 0.8rem; }
        
        .control-slider { width: 100%; height: 4px; border-radius: 2px; background: rgba(255, 255, 255, 0.1); outline: none; -webkit-appearance: none; appearance: none; cursor: pointer; }
        .control-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 12px; height: 12px; border-radius: 50%; background: hsl(var(--hue-complementary), 85%, 55%); cursor: pointer; box-shadow: 0 0 8px hsl(var(--hue-complementary), 85%, 55%); transition: all 0.2s; }
        .control-slider::-webkit-slider-thumb:hover { box-shadow: 0 0 12px hsl(var(--hue-complementary), 85%, 55%); transform: scale(1.2); }
        .control-slider::-moz-range-thumb { width: 12px; height: 12px; border-radius: 50%; background: hsl(var(--hue-complementary), 85%, 55%); cursor: pointer; border: none; box-shadow: 0 0 8px hsl(var(--hue-complementary), 85%, 55%); }
        
        .video-shimmer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; opacity: 0; background: linear-gradient(115deg, transparent 0%, rgba(255, 255, 255, 0.08) 8%, rgba(255, 105, 180, 0.12) 16%, rgba(138, 43, 226, 0.12) 28%, rgba(0, 191, 255, 0.12) 40%, rgba(127, 255, 212, 0.10) 52%, rgba(255, 215, 0, 0.10) 64%, rgba(255, 140, 0, 0.12) 76%, rgba(255, 20, 147, 0.12) 88%, rgba(255, 255, 255, 0.08) 96%, transparent 100%); background-size: 300% 300%; animation: shimmerMove 8s ease-in-out infinite; mix-blend-mode: screen; }
        @keyframes shimmerMove { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
        
        .raindrop { position: fixed; border-radius: 50%; pointer-events: none; animation: dropAppear 5s ease-out forwards; filter: blur(0.5px); }
        @keyframes dropAppear { 0% { opacity: 0; transform: scale(0.6); } 20% { opacity: 0.5; transform: scale(1); } 80% { opacity: 0.5; transform: scale(1); } 100% { opacity: 0; transform: scale(1.05); } }
        
        section { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); padding: 2rem; margin: 2rem 0; }
        h2 { font-size: 1.2rem; font-weight: 400; letter-spacing: 0.1em; margin-bottom: 1.5rem; opacity: 0.8; }
        h3 { font-size: 1rem; font-weight: 400; letter-spacing: 0.05em; margin: 1.5rem 0 1rem 0; opacity: 0.7; }
        p { margin-bottom: 1rem; font-size: 0.9rem; opacity: 0.8; }
        footer { text-align: center; padding: 3rem 0 2rem 0; font-size: 0.75rem; opacity: 0.5; letter-spacing: 0.05em; }
        
        @media (max-width: 768px) { .video-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="flicker">THE MIRROR'S ECHO</h1>

        <div class="intro-text">
            The Mirror's Echo operates as an unlimited edition under open-source principles (AGPL-3.0), ensuring accessibility while sustaining ongoing development. Exhibition licenses and institutional partnerships support the continued evolution of networked digital art practices.<br><br>
            Artist/Technical: <a href="mailto:kristabluedoor@gmail.com">kristabluedoor@gmail.com</a><br>
            Curatorial/Institutional: <a href="mailto:chaoscontemporarycraft@gmail.com">chaoscontemporarycraft@gmail.com</a>
        </div>

        <div class="panel">
            <div class="video-grid" id="videoGrid">
                <div class="video-box" id="localBox">
                    <div class="video-label">Local Camera</div>
                    <div class="video-container">
                        <div class="video-shimmer" id="localShimmer"></div>
                        <video id="localVideo" autoplay muted playsinline></video>
                    </div>
                    <button class="btn" id="startBtn">Start Camera</button>
                </div>
                <div class="video-box" id="remoteBox">
                    <div class="video-label">Remote Stream</div>
                    <div class="video-container">
                        <button class="expand-btn" id="expandBtn">↗</button>
                        <div class="video-shimmer" id="remoteShimmer"></div>
                        <video id="remoteVideo" autoplay playsinline></video>
                    </div>
                    <div class="remote-controls">
                        <button class="btn" id="connectBtn" disabled>Connect</button>
                        <button class="btn" id="disconnectBtn" disabled>Disconnect</button>
                        <button class="btn" id="fullscreenBtn" disabled>Fullscreen</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="color-palette-box">
            <div class="palette-label">Color Palette</div>
            <div class="color-palette">
                <button class="palette-btn active" data-hue="280" style="background: hsl(280, 85%, 55%);" title="Purple"></button>
                <button class="palette-btn" data-hue="320" style="background: hsl(320, 95%, 52%);" title="Pink"></button>
                <button class="palette-btn" data-hue="15" style="background: hsl(15, 95%, 55%);" title="Coral"></button>
                <button class="palette-btn" data-hue="40" style="background: hsl(40, 90%, 55%);" title="Gold"></button>
                <button class="palette-btn" data-hue="120" style="background: hsl(120, 85%, 55%);" title="Green"></button>
                <button class="palette-btn" data-hue="180" style="background: hsl(180, 85%, 55%);" title="Cyan"></button>
                <button class="palette-btn" data-hue="220" style="background: hsl(220, 85%, 55%);" title="Blue"></button>
                <button class="palette-btn" data-hue="0" style="background: hsl(0, 95%, 55%);" title="Red"></button>
            </div>
            <div class="slider-group">
                <div class="slider-header">
                    <span class="slider-label">Color</span>
                    <span class="slider-value" id="colorSliderValue">280°</span>
                </div>
                <input type="range" id="colorSlider" min="0" max="360" value="280" class="control-slider">
            </div>
        </div>

        <div class="control-panel">
            <div class="control-title">Interactive Parameters</div>
            <div class="sliders-grid">
                <div class="slider-group">
                    <div class="slider-header"><span class="slider-label">Hue</span><span class="slider-value" id="hueValue">280°</span></div>
                    <input type="range" id="hueSlider" min="0" max="360" value="280" class="control-slider">
                </div>
                <div class="slider-group">
                    <div class="slider-header"><span class="slider-label">Saturation</span><span class="slider-value" id="satValue">85%</span></div>
                    <input type="range" id="satSlider" min="0" max="100" value="85" class="control-slider">
                </div>
                <div class="slider-group">
                    <div class="slider-header"><span class="slider-label">Lightness</span><span class="slider-value" id="lightValue">55%</span></div>
                    <input type="range" id="lightSlider" min="0" max="100" value="55" class="control-slider">
                </div>
                <div class="slider-group">
                    <div class="slider-header"><span class="slider-label">Intensity</span><span class="slider-value" id="intensityValue">0.50</span></div>
                    <input type="range" id="intensitySlider" min="0" max="1" step="0.01" value="0.50" class="control-slider">
                </div>
                <div class="slider-group">
                    <div class="slider-header"><span class="slider-label">Depth</span><span class="slider-value" id="depthValue">1.0</span></div>
                    <input type="range" id="depthSlider" min="0" max="2" step="0.1" value="1.0" class="control-slider">
                </div>
                <div class="slider-group">
                    <div class="slider-header"><span class="slider-label">Gloss</span><span class="slider-value" id="glossValue">0.60</span></div>
                    <input type="range" id="glossSlider" min="0" max="1" step="0.05" value="0.60" class="control-slider">
                </div>
                <div class="slider-group">
                    <div class="slider-header"><span class="slider-label">Bump</span><span class="slider-value" id="bumpValue">1.0</span></div>
                    <input type="range" id="bumpSlider" min="0" max="2" step="0.1" value="1.0" class="control-slider">
                </div>
                <div class="slider-group">
                    <div class="slider-header"><span class="slider-label">Speed</span><span class="slider-value" id="speedValue">1x</span></div>
                    <input type="range" id="speedSlider" min="0.5" max="4" step="0.5" value="1" class="control-slider">
                </div>
                <div class="slider-group">
                    <div class="slider-header"><span class="slider-label">Halo</span><span class="slider-value" id="haloValue">1.0</span></div>
                    <input type="range" id="haloSlider" min="0" max="2" step="0.1" value="1.0" class="control-slider">
                </div>
                <div class="slider-group">
                    <div class="slider-header"><span class="slider-label">Temporal Intensity</span><span class="slider-value" id="temporalIntensityValue">0%</span></div>
                    <input type="range" id="temporalIntensitySlider" min="0" max="100" value="0" class="control-slider" disabled>
                </div>
            </div>
        </div>

        <section>
            <h2>About</h2>
            <p><em>The Mirror's Echo</em> is a networked interactive work exploring presence, temporality, and reciprocity through real-time video transmission. The piece positions participants as both observers and subjects, creating a feedback loop where actions generate visual echoes that accumulate and transform over time.</p>
            <p>Built on open protocols (WebRTC, LiveKit, NDI), the work operates as distributed infrastructure - each interaction exists simultaneously across multiple nodes: browser, server, and optional processing environments.</p>
        </section>

        <section>
            <h2>Processing Pipeline</h2>
            <div style="background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); padding: 1.5rem; margin: 1.5rem 0; font-size: 0.85rem; line-height: 2; font-family: 'JetBrains Mono', monospace; opacity: 0.8;">
                Camera Input → WebRTC/LiveKit → NVIDIA GPU Processing<br>
                ↓<br>
                Video → TouchDesigner (Visual Processing, Effects, Generative Response)<br>
                ↓<br>
                Composite Output → NDI → OBS → WebRTC Return Path<br>
                ↓<br>
                Remote Viewer (Browser/Display)
            </div>
        </section>

        <footer>© 2025 The Mirror's Echo | Krista Faist</footer>
    </div>

<script>
const colors = [
    'rgba(255, 105, 180, 0.9)', 'rgba(138, 43, 226, 0.9)', 'rgba(75, 0, 130, 0.9)',
    'rgba(0, 191, 255, 0.9)', 'rgba(127, 255, 212, 0.9)', 'rgba(50, 205, 50, 0.9)',
    'rgba(255, 215, 0, 0.9)', 'rgba(255, 140, 0, 0.9)', 'rgba(255, 20, 147, 0.9)'
];

const startTime = Date.now();
const duration = 600000;

// Shimmer fade in
setTimeout(() => {
    document.getElementById('localShimmer').style.transition = 'opacity 3s ease-in';
    document.getElementById('localShimmer').style.opacity = '1';
    document.getElementById('remoteShimmer').style.transition = 'opacity 3s ease-in';
    document.getElementById('remoteShimmer').style.opacity = '1';
}, 100);

function createRaindrop(progress, rainProgress) {
    const drop = document.createElement('div');
    drop.className = 'raindrop';
    drop.style.left = Math.random() * window.innerWidth + 'px';
    drop.style.top = Math.random() * window.innerHeight + 'px';
    
    const color1 = colors[Math.floor(Math.random() * colors.length)];
    const color2 = colors[Math.floor(Math.random() * colors.length)];
    
    let baseOpacity = progress < 0.33 ? 0.17 + (progress * 0.09) : progress < 0.66 ? 0.26 + (progress * 0.09) : 0.37 + (progress * 0.11);
    const haloValue = parseFloat(document.getElementById('haloSlider').value);
    const glowIntensity = (15 + (progress * 65)) * haloValue;
    const glowBoost = (1 + (progress * 1.5)) * haloValue;
    
    drop.style.background = `radial-gradient(circle at 40% 40%, ${color1.replace('0.9', String(baseOpacity * 1.3))} 0%, ${color2.replace('0.9', String(baseOpacity))} 30%, ${color1.replace('0.9', String(baseOpacity * 0.6))} 60%, transparent 100%)`;
    drop.style.boxShadow = `0 0 ${glowIntensity * 0.6 * glowBoost}px ${color1}, 0 0 ${glowIntensity * 1.2 * glowBoost}px ${color2}, 0 0 ${glowIntensity * 2 * glowBoost}px ${color1.replace('0.9', String(baseOpacity * 0.4))}`;
    
    const baseSize = Math.random() < 0.3 ? 20 + (progress * 10) : Math.random() < 0.7 ? 40 + (progress * 20) : 40 + (progress * 50);
    const size = baseSize + (Math.random() * 25);
    drop.style.width = size + 'px';
    drop.style.height = size + 'px';
    drop.style.zIndex = Math.floor(100 + (rainProgress * 9898));
    
    const dur = 5 + Math.random() * 3;
    drop.style.animationDuration = dur + 's';
    document.body.appendChild(drop);
    setTimeout(() => drop.remove(), dur * 1000);
}

function updateTemporalIntensity(rainProgress) {
    const percentage = Math.round(rainProgress * 100);
    document.getElementById('temporalIntensitySlider').value = percentage;
    document.getElementById('temporalIntensityValue').textContent = percentage + '%';
}

function animate() {
    const elapsed = Date.now() - startTime;
    if (elapsed >= 0) {
        const rainProgress = Math.min(elapsed / duration, 1.0);
        const progress = rainProgress;
        updateTemporalIntensity(rainProgress);
        
        const baseRate = 0.05;
        const exponentialGrowth = Math.pow(progress, 2.5);
        let dropProbability = baseRate * (1 + exponentialGrowth * 40);
        if (progress > 0.66) dropProbability *= 1 + ((progress - 0.66) / 0.34) * 8;
        
        if (Math.random() < dropProbability) createRaindrop(progress, rainProgress);
        if (progress > 0.85) {
            const extraDrops = Math.floor(Math.random() * (((progress - 0.85) / 0.15) * 12));
            for (let i = 0; i < extraDrops; i++) setTimeout(() => createRaindrop(progress, rainProgress), Math.random() * 1000);
        }
    }
    if (elapsed < duration + 60000) requestAnimationFrame(animate);
}
animate();

// Video controls
const expandBtn = document.getElementById('expandBtn');
const videoGrid = document.getElementById('videoGrid');
const localBox = document.getElementById('localBox');
let isExpanded = false;

expandBtn.addEventListener('click', () => {
    isExpanded = !isExpanded;
    localBox.classList.toggle('hidden', isExpanded);
    videoGrid.classList.toggle('collapsed', isExpanded);
    expandBtn.textContent = isExpanded ? '↙' : '↗';
});

document.getElementById('startBtn').addEventListener('click', async function() {
    this.disabled = true;
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { width: { ideal: 1280 }, height: { ideal: 720 } }, audio: true });
        document.getElementById('localVideo').srcObject = stream;
        document.getElementById('connectBtn').disabled = false;
    } catch (e) {
        console.error('Camera error:', e);
        this.disabled = false;
    }
});

document.getElementById('connectBtn').addEventListener('click', function() {
    this.disabled = true;
    setTimeout(() => {
        document.getElementById('disconnectBtn').disabled = false;
        document.getElementById('fullscreenBtn').disabled = false;
    }, 1000);
});

document.getElementById('disconnectBtn').addEventListener('click', function() {
    this.disabled = true;
    document.getElementById('fullscreenBtn').disabled = true;
    document.getElementById('connectBtn').disabled = false;
});

document.getElementById('fullscreenBtn').addEventListener('click', () => {
    const v = document.getElementById('remoteVideo');
    if (v.requestFullscreen) v.requestFullscreen();
});

// Color controls
function getComplementaryHue(hue) { return (parseInt(hue) + 180) % 360; }

document.getElementById('colorSlider').addEventListener('input', function() {
    const hue = this.value;
    const comp = getComplementaryHue(hue);
    document.getElementById('colorSliderValue').textContent = hue + '°';
    document.getElementById('hueSlider').value = hue;
    document.getElementById('hueValue').textContent = hue + '°';
    document.documentElement.style.setProperty('--hue-value', hue);
    document.documentElement.style.setProperty('--hue-complementary', comp);
    document.querySelectorAll('.palette-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.hue === hue));
});

document.getElementById('hueSlider').addEventListener('input', function() {
    const hue = this.value;
    const comp = getComplementaryHue(hue);
    document.getElementById('hueValue').textContent = hue + '°';
    document.getElementById('colorSliderValue').textContent = hue + '°';
    document.getElementById('colorSlider').value = hue;
    document.documentElement.style.setProperty('--hue-value', hue);
    document.documentElement.style.setProperty('--hue-complementary', comp);
});

document.querySelectorAll('.palette-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const hue = this.dataset.hue;
        document.getElementById('hueSlider').value = hue;
        document.getElementById('colorSlider').value = hue;
        document.getElementById('hueValue').textContent = hue + '°';
        document.getElementById('colorSliderValue').textContent = hue + '°';
        document.documentElement.style.setProperty('--hue-value', hue);
        document.documentElement.style.setProperty('--hue-complementary', getComplementaryHue(hue));
        document.querySelectorAll('.palette-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
    });
});

// Other sliders
document.getElementById('satSlider').addEventListener('input', function() { document.getElementById('satValue').textContent = this.value + '%'; });
document.getElementById('lightSlider').addEventListener('input', function() { document.getElementById('lightValue').textContent = this.value + '%'; });
document.getElementById('intensitySlider').addEventListener('input', function() { document.getElementById('intensityValue').textContent = parseFloat(this.value).toFixed(2); });
document.getElementById('depthSlider').addEventListener('input', function() { document.getElementById('depthValue').textContent = parseFloat(this.value).toFixed(1); });
document.getElementById('glossSlider').addEventListener('input', function() { document.getElementById('glossValue').textContent = parseFloat(this.value).toFixed(2); });
document.getElementById('bumpSlider').addEventListener('input', function() { document.getElementById('bumpValue').textContent = parseFloat(this.value).toFixed(1); });
document.getElementById('speedSlider').addEventListener('input', function() { document.getElementById('speedValue').textContent = parseFloat(this.value).toFixed(1) + 'x'; });
document.getElementById('haloSlider').addEventListener('input', function() { document.getElementById('haloValue').textContent = parseFloat(this.value).toFixed(1); });
</script>
</body>
</html>