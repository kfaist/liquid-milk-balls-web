<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Minimal LiveKit Viewer</title>
    <style>
        * { margin: 0; padding: 0; }
        body { 
            background: #000; 
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }
        video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        #status {
            position: fixed;
            top: 10px;
            left: 10px;
            color: #fff;
            font-family: monospace;
            background: rgba(0,0,0,0.8);
            padding: 8px;
            border-radius: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div id="status">Initializing...</div>
    <video id="remoteVideo" autoplay playsinline muted></video>

    <script src="https://unpkg.com/livekit-client/dist/livekit-client.umd.min.js"></script>
    <script>
        const statusDiv = document.getElementById('status');
        const videoElement = document.getElementById('remoteVideo');
        
        async function connectToLiveKit() {
            try {
                statusDiv.textContent = 'Fetching token...';
                
                const response = await fetch('/api/viewer-token');
                const data = await response.json();
                
                statusDiv.textContent = 'Connecting to LiveKit...';
                
                const room = new LivekitClient.Room();
                
                room.on(LivekitClient.RoomEvent.TrackSubscribed, (track, publication, participant) => {
                    if (track.kind === LivekitClient.Track.Kind.Video) {
                        statusDiv.textContent = 'Video connected!';
                        statusDiv.style.color = '#00ff00';
                        track.attach(videoElement);
                    }
                });
                
                room.on(LivekitClient.RoomEvent.Disconnected, () => {
                    statusDiv.textContent = 'Disconnected';
                    statusDiv.style.color = '#ff0000';
                });
                
                await room.connect(data.url, data.token);
                statusDiv.textContent = 'Connected - Waiting for video...';
                
            } catch (error) {
                statusDiv.textContent = 'Error: ' + error.message;
                statusDiv.style.color = '#ff0000';
                console.error(error);
            }
        }
        
        connectToLiveKit();
    </script>
</body>
</html>
